'use strict';$(document).ready(function(){function h(c){var a=$(".applicant_id").val()?$(".applicant_id").val():"NULL",b=$(".manufacture_id").val()?$(".manufacture_id").val():"NULL",d=$(".factory_id").val()?$(".factory_id").val():"NULL",k=$(".lab_name").val()?$(".lab_name").val():"NULL",p=$(".start_Date").val()?$(".start_Date").val():"NULL",u=$(".end_Date").val()?$(".end_Date").val():"NULL",v=$(".destinaition").val()?$(".destinaition").val():"NULL",w=$(".application").val()?$(".application").val():
"NULL",x=$(".search").val()?btoa($(".search").val()):"NULL";$.ajax({async:!0,url:e+"Reports/report_listing/"+a+"/"+b+"/"+d+"/"+k+"/"+p+"/"+u+"/"+v+"/"+w+"/"+x+"/"+c,type:"get",dataType:"json",success:function(q){$("#gmark_pagination").html(q.pagination);q=q.result;$("#gmark_list").empty();$("#gmark_list").html(q)}})}var l=$('meta[name="_tokken"]').attr("content"),e=$("body").attr("data-url"),f=0,g=1;$(document).on("click",".content_edit",function(){var c=$(this).data("id");$(".contant_id").val(c);
$.ajax({async:!0,url:e+"Reports/get_content",type:"post",data:{_tokken:l,id:c},success:function(a){a=$.parseJSON(a);console.log(a);a&&(a.date_of_issuance&&$('#edit_content_upload input[name="date_of_issuance"]').val(a.date_of_issuance),a.cab_method&&$('#edit_content_upload input[name="cab_method"]').val(a.cab_method),a.technical_regulation&&$('#edit_content_upload input[name="technical_regulation"]').val(a.technical_regulation),a.notify_body&&$('#edit_content_upload input[name="notify_body"]').val(a.notify_body),
a.means_shipping&&$('#edit_content_upload input[name="means_shipping"]').val(a.means_shipping),a.shipment_doc&&$('#edit_content_upload input[name="shipment_doc"]').val(a.shipment_doc),a.pro_name&&$('#edit_content_upload input[name="pro_name"]').val(a.pro_name),a.trade_brand&&$('#edit_content_upload input[name="trade_brand"]').val(a.trade_brand),a.country_origin&&$('#edit_content_upload input[name="country_origin"]').val(a.country_origin),a.designation&&$('#edit_content_upload input[name="designation"]').val(a.designation),
a.lot_no&&$('#edit_content_upload input[name="lot_no"]').val(a.lot_no),a.standard_applies&&$('#edit_content_upload input[name="standard_applies"]').val(a.standard_applies),a.country_complains&&$('#edit_content_upload input[name="country_complains"]').val(a.country_complains),a.file_ref&&$('#edit_content_upload input[name="file_ref"]').val(a.file_ref),a.certified_pro&&$('#edit_content_upload input[name="certified_pro"]').val(a.certified_pro),a.electrical_rating&&$('#edit_content_upload input[name="electrical_rating"]').val(a.electrical_rating),
a.pro_dimension&&$('#edit_content_upload input[name="pro_dimension"]').val(a.pro_dimension),a.coc_type&&$("#edit_content_upload #coc_type").val(a.coc_type.coc_type),$(".product tbody").html(""),a.result?$.each(a.result,function(b,d){d='<tr ><td><textarea  name="product['+b+'][description]" class="form-control">'+d.description+'</textarea></td><td><textarea  name="product['+b+'][qty]" class="form-control">'+d.qty+'</textarea></td><td><textarea  name="product['+b+'][manufacturer]" class="form-control">'+
d.manufacturer+'</textarea></td><td><textarea  name="product['+b+'][test_report_details]" class="form-control">'+d.test_report_details+'</textarea></td><td><textarea  name="product['+b+'][standards]" class="form-control">'+d.standards+'</textarea></td><td><input type="checkbox" name="record"></td></tr>';$(".product tbody").append(d);g=b+1}):(a='<tr ><td><textarea  name="product['+g+'][description]" class="form-control"></textarea></td><td><textarea  name="product['+g+'][qty]" class="form-control"></textarea></td><td><textarea  name="product['+
g+'][manufacturer]" class="form-control"></textarea></td><td><textarea  name="product['+g+'][test_report_details]" class="form-control"></textarea></td><td><textarea  name="product['+g+'][standards]" class="form-control"></textarea></td><td><input type="checkbox" name="record"></td></tr>',$(".product tbody").append(a)))},error:function(a){console.log(a)}})});$(".add-row").click(function(){var c='<tr ><td><textarea  name="product['+g+'][description]" class="form-control"></textarea></td><td><textarea  name="product['+
g+'][qty]" class="form-control"></textarea></td><td><textarea  name="product['+g+'][manufacturer]" class="form-control"></textarea></td><td><textarea  name="product['+g+'][test_report_details]" class="form-control"></textarea></td><td><textarea  name="product['+g+'][standards]" class="form-control"></textarea></td><td><input type="checkbox" name="record"></td></tr>';$(".product tbody").append(c);g++});$(".delete-row").on("click",function(){$(".product tbody").find('input[name="record"]').each(function(){$(this).is(":checked")&&
$(this).parents("tr").remove()})});$("#gmark_pagination").on("click","a",function(c){c.preventDefault();f=$(this).attr("data-ci-pagination-page");h(f)});h(0);$(document).on("click",".submit_listing",function(){f=0;h(f)});$(document).on("click",".clear_listing",function(){$("input").val("");$("#listing_filter").trigger("reset");f=0;h(f)});$(document).on("keyup",".focusout_autosuggestion",function(){var c=$(this).val(),a=$(this);c?$.ajax({async:!0,url:e+"Gmark/search",type:"POST",data:{key:c,_tokken:l,
table:"gmark_customers",coloum:"entity_name",select:"customers_id,entity_name"},success:function(b){b=$.parseJSON(b);var d="";b?($.each(b,function(k,p){d+='<li class="list-group-item list-group-item-action li-state" data-id="'+p.customers_id+'">'+p.entity_name+"</li>"}),d+=""):(d+='<li class="list-group-item list-group-item-action li-state" data-id="NULL">NO RECORD FOUND</li>',$(".applicant_id").val("NULL"));a.siblings("div.drop_down_ul.posiotio").children("ul.itemList1").html(d).fadeIn()},error:function(b){console.log(b)}}):
a.siblings('input[type="hidden"]').val("NULL")});$(".itemList1").on("click","li",function(){$(this).parents().siblings('input[type="text"]').val($(this).text());$(this).parents().siblings('input[type="hidden"]').val($(this).data("id"));$(".itemList1").fadeOut()});$(".focusout_autosuggestion").focusout(function(){$(this).siblings("div.drop_down_ul.posiotio").children("ul.itemList1").fadeOut()});$(document).on("click",".rear_image",function(){var c=$(this).data("id");$(".doc_upload_request").val(c);
$.ajax({async:!0,url:e+"Reports/get_image",type:"post",data:{_tokken:l,registration_id:c},success:function(a){a=$.parseJSON(a);$("#front-view,#rear-view,#product_label_left,#product_label_left2").html("");a?(iziToast.success({title:"success",message:"RECORD FOUND",position:"topRight"}),a.front_img&&$("#front-view").html('<img src="'+a.front_img+'" alt="GEOCHEMGTS" width="200px">'),a.product_label&&$("#product_label_left").html('<img src="'+a.product_label+'" alt="GEOCHEMGTS" width="200px">'),a.product_label2&&
$("#product_label_left2").html('<img src="'+a.product_label2+'" alt="GEOCHEMGTS" width="200px">'),a.rear_img&&$("#rear-view").html('<img src="'+a.rear_img+'" alt="GEOCHEMGTS" width="200px">')):iziToast.warning({title:"ERROR",message:"RECORD NOT FOUND",position:"topRight"})},error:function(){}})});var n=1;$(document).on("submit","#product_upload_image",function(c){c.preventDefault();var a=$(this);c=new FormData(this);2>n?(n++,$(".myprogress").text("0%"),$(".myprogress").css("width","0%"),$.ajax({async:!0,
url:e+"Reports/image_upload",type:"POST",processData:!1,contentType:!1,data:c,xhr:function(){var b=new window.XMLHttpRequest;b.upload.addEventListener("progress",function(d){d.lengthComputable&&(d=d.loaded/d.total,d=Math.floor(100*d),$(".myprogress").text(d+"%"),$(".myprogress").animate({width:d+"%"},{duration:500}))},!1);return b},success:function(b){$(".error_document_upload").html("");b=$.parseJSON(b);0<b.status?($(".myprogress").text("0%"),$(".myprogress").css("width","0%"),n=1,iziToast.success({title:"success",
message:b.msg,position:"topRight"}),$('#report_add button[data-dismiss="modal"]').click(),a.trigger("reset")):($(".myprogress").text("0%"),$(".myprogress").css("width","0%"),n=1,iziToast.warning({title:"ERROR",message:b.msg,position:"topRight"}));b.errors&&$(".error_document_upload").html(b.errors)},error:function(b){n=1;console.log(b)}})):iziToast.warning({title:"WAIT",message:"WAIT FOR UPLOAD",position:"topRight"})});$(document).on("click",".content_add",function(){var c=$(this).data("id");$(".contant_id").val(c)});
$(document).on("click",".re_generate_request",function(){var c=$(this).data("id");$(".registration_id_regenrate").val(c)});$(document).on("click",".content_edit",function(){var c=$(this).data("id");$(".contant_id").val(c)});var m=1;$(document).on("submit","#content_upload",function(c){var a=$(this);c.preventDefault();2>m?(m++,$.ajax({async:!0,url:e+"Reports/content_upload",type:"post",data:$(this).serialize(),success:function(b){$("#error_add_content").html("");b=$.parseJSON(b);0<b.status?(h(f),m=
1,iziToast.success({title:"success",message:b.msg,position:"topRight"}),$('#report_content_add button[data-dismiss="modal"]').click(),a.trigger("reset")):(m=1,iziToast.warning({title:"ERROR",message:b.msg,position:"topRight"}));b.errors&&$("#error_add_content").html(b.errors)},error:function(b){console.log(b)}})):iziToast.warning({title:"ERROR",message:"WAIT FOR RESPONSE",position:"topRight"})});$(document).on("submit","#edit_content_upload",function(c){c.preventDefault();2>m?(m++,$.ajax({async:!0,
url:e+"Reports/edit_content_upload",type:"post",data:$(this).serialize(),success:function(a){$("#error_edit_content").html("");a=$.parseJSON(a);0<a.status?(h(f),m=1,iziToast.success({title:"success",message:a.msg,position:"topRight"}),$('#report_content_edit button[data-dismiss="modal"]').click()):(m=1,iziToast.warning({title:"ERROR",message:a.msg,position:"topRight"}));a.errors&&$("#error_edit_content").html(a.errors)},error:function(a){console.log(a)}})):iziToast.warning({title:"ERROR",message:"WAIT FOR RESPONSE",
position:"topRight"})});$(document).on("click",".pdf_view",function(){var c=$(this).data("url"),a=$(this).data("id"),b=$(this).data("approved");$("#iframe_pdf").html('<iframe height="400px" width="100%" src="'+c+'" frameborder="0"></iframe>');0<b?$("#release_pdf").html('<a data-id="'+a+'" href="javascript:void(0);" class="btn btn-sm btn-primary release_pdf">RELEASE</a>'):$("#release_pdf").html('<div class="row"><div class="col-sm-12"><h6>PLEASE FIRST APPROVED FOR RELEASE</h6></div></div>')});$(document).on("click",
".pdf_report",function(){var c=$(this).data("id");swal({title:"Are you sure?",text:"Once APPROVED, you will not be able to REJECT this REPORT!",icon:"warning",buttons:!0,dangerMode:!0}).then(a=>{a?$.ajax({async:!0,url:e+"Reports/approved_pdf",type:"post",data:{id:c,_tokken:l},success:function(b){b=$.parseJSON(b);0<b.status?(swal("Poof! Your REPORT file has been APPROVED!",{icon:"success"}),iziToast.success({title:"success",message:b.msg,position:"topRight"}),h(f)):iziToast.warning({title:"ERROR",
message:b.msg,position:"topRight"})},error:function(b){console.log(b)}}):swal("Your REPORT is NOT APPROVED!")})});var r=1;$(document).on("click",".release_pdf",function(){var c=$(this).data("id");1==r?(r++,swal({title:"Are you sure?",text:"Once RELEASE, you will not be able to EDIT ANY THING IN this REPORT!",icon:"warning",buttons:!0,dangerMode:!0}).then(a=>{a?$.ajax({async:!0,url:e+"Reports/release_pdf",type:"post",data:{id:c,_tokken:l},success:function(b){r=1;b=$.parseJSON(b);0<b.status?(swal("Poof! Your REPORT file has been RELEASE!",
{icon:"success"}),iziToast.success({title:"success",message:b.msg,position:"topRight"}),h(f),$('#report_content_approved button[data-dismiss="modal"]').click()):iziToast.warning({title:"ERROR",message:b.msg,position:"topRight"})},error:function(b){r=1;console.log(b)}}):swal("Your REPORT is NOT RELEASE!")})):iziToast.warning({title:"ERROR",message:"WAIT FOR RESPONSE",position:"topRight"})});$(document).on("click",".pdf_type",function(){var c=$(this).data("reg"),a=$(this).data("id"),b=null;b=1==a?"GULF TYPE EXAMINATION CERTIFICATE":
"CERTIFICATION OF CONFORMITY";swal({title:"Are you sure?",text:"Once "+b+" MARK, you will not be able to CHANGE this REPORT!",icon:"warning",buttons:!0,dangerMode:!0}).then(d=>{d?$.ajax({async:!0,url:e+"Reports/pdf_mark",type:"post",data:{id:c,type:a,_tokken:l},success:function(k){k=$.parseJSON(k);0<k.status?(swal("Poof! Your REPORT file has been MARK "+b,{icon:"success"}),iziToast.success({title:"success",message:k.msg,position:"topRight"}),h(f)):iziToast.warning({title:"ERROR",message:k.msg,position:"topRight"})},
error:function(k){console.log(k)}}):swal("Your REPORT is NOT MARK")})});var t=1;$(document).on("submit","#regenrate_approval",function(c){c.preventDefault();1==t?(t++,$.ajax({async:!0,url:e+"Regenerate/approval",type:"post",data:$(this).serialize(),success:function(a){$("#error_regenrate_app").html("");a=$.parseJSON(a);0<a.status?(h(f),iziToast.success({title:"success",message:a.msg,position:"topRight"}),$('#request_regenrate button[data-dismiss="modal"]').click()):iziToast.warning({title:"ERROR",
message:a.msg,position:"topRight"});t=1;a.errors?$("#error_regenrate_app").html(a.errors):$("#error_regenrate_app").html("")},error:function(a){console.log(a);t=1}})):iziToast.warning({title:"ERROR",message:"WAIT FOR RESPONSE",position:"topRight"})});$(document).on("click",".re_genrate_process",function(){var c=$(this).data("id");swal({title:"Are you sure?",text:"Once RE-GENERATE, you will not be able to BACK this REPORT!",icon:"warning",buttons:!0,dangerMode:!0}).then(a=>{a?$.ajax({async:!0,url:e+
"Reports/re_genrate_process",type:"post",data:{id:c,_tokken:l},success:function(b){b=$.parseJSON(b);0<b.status?(swal("Poof! Your REPORT file has been APPROVED!",{icon:"success"}),iziToast.success({title:"success",message:b.msg,position:"topRight"}),h(f)):iziToast.warning({title:"ERROR",message:b.msg,position:"topRight"})},error:function(b){console.log(b)}}):swal("Your REPORT is NOT RE-GENERATE!")})});$(document).on("click",".log",function(){var c=$(this).data("id");$.ajax({url:e+"Gmark/log",data:{id:c,
_tokken:l},type:"POST",success:function(a){a=$.parseJSON(a);$("#history_view").html(a)},error:function(a){console.log(a)}})})});